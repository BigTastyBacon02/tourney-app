<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>1×1 Auswahl – ZIP-Only (Fix2)</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1f6feb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="1×1 Auswahl">
  <link rel="apple-touch-icon" href="icon-180.png">
  <style>
    :root{--bg:#0b0c0f;--card:#111317;--text:#e6e7ea;--line:#1c1f26;--brand:#1f6feb;--muted:#9aa3b2}
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);padding:16px}
    h1{font-size:22px;margin:0 0 8px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:8px 0}
    textarea,input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f1218;color:#e6e7ea;font-size:16px}
    .btn{border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
    .pri{background:var(--brand);color:#fff}
    .sec{background:#161a22;color:#e6e7ea;border:1px solid var(--line)}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:12px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;margin:4px;border-radius:999px;background:#161a22;border:1px solid var(--line)}
    .thumb{width:20px;height:20px;border-radius:6px;object-fit:cover}
    .pair{display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:start;margin-top:8px}
    .opt{display:flex;flex-direction:column;gap:10px}
    .bigimg{width:240px;height:240px;object-fit:cover;border-radius:14px;border:1px solid var(--line);background:#0f131a}
    .gal{display:flex;gap:8px;overflow:auto;padding-bottom:4px}
    .gal img{width:76px;height:76px;border-radius:10px;object-fit:cover;border:1px solid var(--line);background:#0f131a;flex:0 0 auto;cursor:pointer}
    .mini{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <h1>1×1 Auswahl – ZIP-Only (Fix2)</h1>
  <div class="card">
    <div class="row">
      <label class="mini">Ziel-Anzahl<br><input id="target" type="number" value="1" min="1"></label>
      <button id="startBtn" class="btn pri">Starten</button>
      <button id="demoBtn" class="btn sec">Demo</button>
    </div>
    <textarea id="names" placeholder="Name 1
Name 2
Name 3"></textarea>
  </div>

  <div class="layout">
    <div class="card">
      <h3 style="margin:0 0 6px">Drin <span class="mini" id="cntIn">0</span></h3>
      <div id="listIn"></div>
      <h3 style="margin:10px 0 6px">Raus <span class="mini" id="cntOut">0</span></h3>
      <div id="listOut"></div>
    </div>

    <div class="card">
      <div id="arena" style="display:none">
        <div class="pair">
          <div class="opt">
            <img id="li" class="bigimg" alt="links">
            <div class="gal" id="lgal"></div>
            <button id="leftBtn">–</button>
            <div class="mini"><a id="lg" href="#" target="_blank">Quelle</a></div>
          </div>
          <div style="align-self:center">vs</div>
          <div class="opt">
            <img id="ri" class="bigimg" alt="rechts">
            <div class="gal" id="rgal"></div>
            <button id="rightBtn">–</button>
            <div class="mini"><a id="rg" href="#" target="_blank">Quelle</a></div>
          </div>
        </div>
        <div class="row" style="margin-top:8px">
          <button id="undoBtn" class="btn sec" disabled>Rückgängig</button>
          <button id="shuffleBtn" class="btn sec">Neu mischen</button>
          <div class="mini" id="status"></div>
        </div>
      </div>
      <div id="result" style="display:none">
        <h3 style="margin:0 0 6px">Übrig</h3>
        <div id="survivors"></div>
      </div>
    </div>
  </div>

<script>
const $=s=>document.querySelector(s);
const namesEl=$('#names'), targetEl=$('#target');
const startBtn=$('#startBtn'), demoBtn=$('#demoBtn');
const arena=$('#arena'), result=$('#result'), survivors=$('#survivors');
const li=$('#li'), ri=$('#ri'), lgal=$('#lgal'), rgal=$('#rgal');
const leftBtn=$('#leftBtn'), rightBtn=$('#rightBtn');
const lg=$('#lg'), rg=$('#rg'), undoBtn=$('#undoBtn'), shuffleBtn=$('#shuffleBtn');
const listIn=$('#listIn'), listOut=$('#listOut'), cntIn=$('#cntIn'), cntOut=$('#cntOut'), status=$('#status');

let pool=[], out=[], currentPair=[], history=[], target=1;
const LS_KEY='zipOnlyFix2Pics', localGallery={};

function uniq(a){return Array.from(new Set(a));}
function hostOf(u){try{return new URL(u).host;}catch(e){return ''; }}

// Minimal sources: Wikipedia thumb + Openverse
const OPENVERSE = (name,n=8)=>`https://api.openverse.engineering/v1/images/?q=${encodeURIComponent(name)}&page_size=${n}&mature=true`;
const WIKI = (name,size=320)=>`https://de.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages&piprop=thumbnail&pithumbsize=${size}&generator=search&gsrlimit=1&gsrsearch=${encodeURIComponent(name)}`;

function loadLocal(){ try{ Object.assign(localGallery, JSON.parse(localStorage.getItem(LS_KEY)||'{}')); }catch(e){} }
function saveLocal(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(localGallery)); }catch(e){} }
async function fileToDataURL(file, maxW=640){
  const img = document.createElement('img'); const fr = new FileReader();
  const p = new Promise((res,rej)=>{
    fr.onload = ()=>{ img.onload = ()=>{
      const scale = Math.min(1, maxW / img.width);
      const w = Math.round(img.width*scale), h = Math.round(img.height*scale);
      const cnv = document.createElement('canvas'); cnv.width=w; cnv.height=h;
      const ctx=cnv.getContext('2d'); ctx.drawImage(img,0,0,w,h);
      res(cnv.toDataURL('image/jpeg', 0.9));
    }; img.onerror=rej; img.src=fr.result; };
    fr.onerror=rej;
  });
  fr.readAsDataURL(file); return p;
}
async function wikiPrimary(name){
  try{
    const r=await fetch(WIKI(name,480)); const j=await r.json();
    if(j&&j.query&&j.query.pages){ const v=Object.values(j.query.pages)[0]; if(v&&v.thumbnail) return v.thumbnail.source; }
  }catch(e){}
  return null;
}
async function openverseList(name, n=12){
  try{
    const r=await fetch(OPENVERSE(name,n)); if(!r.ok) return [];
    const j=await r.json(); return (j.results||[]).map(it=>({src:it.thumbnail||it.url, page:it.foreign_landing_url||it.url}));
  }catch(e){ return []; }
}
async function renderSide(name, bigImgEl, galEl, linkEl){
  bigImgEl.removeAttribute('src'); linkEl.href='#'; galEl.innerHTML='';
  let arr = (localGallery[name]||[]).map(u=>({src:u,page:'lokal'}));
  const w = await wikiPrimary(name); if(w) arr.unshift({src:w, page:'Wikipedia'});
  const ov = await openverseList(name, 20); arr = arr.concat(ov);
  const seen=new Set(), imgs=[];
  arr.forEach(it=>{ if(it && it.src && !seen.has(it.src)){ seen.add(it.src); imgs.push(it); } });
  if(imgs[0]){ bigImgEl.src=imgs[0].src; linkEl.href=imgs[0].page||imgs[0].src; }
  imgs.forEach(it=>{ const im=document.createElement('img'); im.src=it.src; im.title=(it.page||'Quelle');
    im.onclick=()=>{ bigImgEl.src=it.src; linkEl.href=it.page||it.src; }; galEl.appendChild(im); });
}
function renderLists(){
  cntIn.textContent=pool.length; cntOut.textContent=out.length;
  listIn.innerHTML=''; listOut.innerHTML='';
  pool.forEach(n=>{ const div=document.createElement('div'); div.className='pill'; div.textContent=n; listIn.appendChild(div); });
  out.forEach(n=>{ const div=document.createElement('div'); div.className='pill'; div.textContent=n; listOut.appendChild(div); });
}
function drawPair(){
  if(pool.length<=1) return;
  const a=Math.floor(Math.random()*pool.length);
  let b=Math.floor(Math.random()*pool.length); while(b===a) b=Math.floor(Math.random()*pool.length);
  currentPair=[pool[a],pool[b]]; leftBtn.textContent=currentPair[0]; rightBtn.textContent=currentPair[1];
  renderSide(currentPair[0], li, lgal, lg); renderSide(currentPair[1], ri, rgal, rg);
  status.textContent = pool.length + ' aktiv | Ziel: ' + target; arena.style.display='block';
}
function start(){
  pool = uniq(namesEl.value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean));
  out=[]; history=[]; target=Math.max(1,parseInt(targetEl.value||'1',10));
  if(pool.length<2||target>=pool.length){ alert('Mind. 2 unterschiedliche Namen & Ziel kleiner als Anzahl.'); return; }
  renderLists(); drawPair(); undoBtn.disabled=true; result.style.display='none';
}
function pick(idx){
  if(currentPair.length<2) return;
  const w=currentPair[idx], l=currentPair[1-idx];
  pool = pool.filter(n=>n!==w && n!==l); pool.push(w); out.push(l); history.push({w,l}); undoBtn.disabled=false;
  if(pool.length<=target){ result.style.display='block'; survivors.innerHTML=''; pool.forEach(n=>{ const el=document.createElement('div'); el.className='pill'; el.textContent=n; survivors.appendChild(el);}); arena.style.display='none'; return; }
  renderLists(); drawPair();
}
function undo(){
  const h=history.pop(); if(!h) return;
  pool = pool.filter(n=>n!==h.w); const j = out.lastIndexOf(h.l); if(j>-1) out.splice(j,1);
  pool.push(h.w,h.l); undoBtn.disabled = history.length===0; renderLists(); drawPair();
}
startBtn.onclick = start;
demoBtn.onclick = ()=>{ namesEl.value = ['Mia Malkova','Johnny Sins','Margot Robbie','Tom Cruise'].join('\n'); };
leftBtn.onclick = ()=> pick(0); rightBtn.onclick = ()=> pick(1);
undoBtn.onclick = undo; shuffleBtn.onclick = drawPair;
loadLocal();
</script>
</body>
</html>
