<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>1×1 Auswahl</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1f6feb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="1×1 Auswahl">
  <link rel="apple-touch-icon" href="icon-180.png">
  <style>
    :root{--bg:#0b0c0f;--card:#111317;--text:#e6e7ea;--line:#1c1f26;--brand:#1f6feb;--muted:#9aa3b2}
    body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);padding:16px}
    h1{font-size:22px;margin:0 0 8px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:8px 0}
    textarea,input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f1218;color:var(--text);font-size:16px}
    .btn{border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
    .pri{background:var(--brand);color:#fff}
    .sec{background:#161a22;color:#e6e7ea;border:1px solid var(--line)}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:12px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;margin:4px;border-radius:999px;background:#161a22;border:1px solid var(--line)}
    .thumb{width:20px;height:20px;border-radius:6px;object-fit:cover}
    .pair{display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:start;margin-top:8px}
    .opt{display:flex;flex-direction:column;align-items:center;gap:8px}
    .bigimg{width:220px;height:220px;object-fit:cover;border-radius:14px;border:1px solid var(--line);background:#0f131a}
    .opt button{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#18202b;color:var(--text);font-weight:800}
    .mini{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <h1>1×1 Auswahl</h1>
  <div class="card">
    <div class="row">
      <label class="mini">Ziel-Anzahl<br><input id="target" type="number" value="1" min="1"></label>
      <label class="mini">Erwachsenenmodus (Bilder ohne Filter)<br><input id="adult" type="checkbox" checked></label>
      <button id="startBtn" class="btn pri">Starten</button>
      <button id="demoBtn" class="btn sec">Demo</button>
    </div>
    <textarea id="names" placeholder="Name 1
Name 2
Name 3"></textarea>
  </div>

  <div class="layout">
    <div class="card">
      <h3 style="margin:0 0 6px">Drin <span class="mini" id="cntIn">0</span></h3>
      <div id="listIn"></div>
      <h3 style="margin:10px 0 6px">Raus <span class="mini" id="cntOut">0</span></h3>
      <div id="listOut"></div>
    </div>

    <div class="card">
      <div id="arena" style="display:none">
        <div class="pair">
          <div class="opt">
            <img id="li" class="bigimg" alt="links">
            <button id="leftBtn">–</button>
            <a id="lg" class="mini" href="#" target="_blank">Quelle</a>
          </div>
          <div style="align-self:center">vs</div>
          <div class="opt">
            <img id="ri" class="bigimg" alt="rechts">
            <button id="rightBtn">–</button>
            <a id="rg" class="mini" href="#" target="_blank">Quelle</a>
          </div>
        </div>
        <div class="row" style="margin-top:8px">
          <button id="undoBtn" class="btn sec" disabled>Rückgängig</button>
          <button id="shuffleBtn" class="btn sec">Neu mischen</button>
          <div class="mini" id="status"></div>
        </div>
      </div>
      <div id="result" style="display:none">
        <h3 style="margin:0 0 6px">Übrig</h3>
        <div id="survivors"></div>
      </div>
    </div>
  </div>

<script>
const $=s=>document.querySelector(s);
const namesEl=$('#names'), targetEl=$('#target'), adultEl=$('#adult');
const startBtn=$('#startBtn'), demoBtn=$('#demoBtn');
const arena=$('#arena'), result=$('#result'), survivors=$('#survivors');
const li=$('#li'), ri=$('#ri'), leftBtn=$('#leftBtn'), rightBtn=$('#rightBtn');
const lg=$('#lg'), rg=$('#rg'), undoBtn=$('#undoBtn'), shuffleBtn=$('#shuffleBtn');
const listIn=$('#listIn'), listOut=$('#listOut'), cntIn=$('#cntIn'), cntOut=$('#cntOut'), status=$('#status');

let pool=[], out=[], currentPair=[], history=[], target=1;
const cacheImgs={};

async function wikiThumb(name){
  const u='https://de.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages&piprop=thumbnail&pithumbsize=300&generator=search&gsrlimit=1&gsrsearch='+encodeURIComponent(name);
  try{const r=await fetch(u);const j=await r.json();
    if(j&&j.query&&j.query.pages){const v=Object.values(j.query.pages)[0];
      if(v&&v.thumbnail) return {src:v.thumbnail.source,creditUrl:'https://de.wikipedia.org/wiki/'+encodeURIComponent(name)};}
  }catch(e){}
  return null;
}

async function openverseThumb(name, allowMature){
  const u='https://api.openverse.engineering/v1/images/?q='+encodeURIComponent(name)+'&page_size=1'+(allowMature?'&mature=true':'&mature=false');
  try{const r=await fetch(u);if(!r.ok)return null;const j=await r.json();
    const it=j&&j.results&&j.results[0];if(!it)return null;
    return {src:it.thumbnail||it.url,creditUrl:it.foreign_landing_url||it.url};}
  catch(e){return null;}
}

async function loadPortrait(name){
  if(name in cacheImgs) return cacheImgs[name];
  let pic=await wikiThumb(name);
  if(!pic) pic=await openverseThumb(name, adultEl.checked);
  cacheImgs[name]=pic||null; return cacheImgs[name];
}

function pill(name, toBox){
  const div=document.createElement('div');div.className='pill';
  const img=document.createElement('img');img.className='thumb';div.appendChild(img);
  div.appendChild(document.createTextNode(name));
  toBox.appendChild(div);
  (async()=>{const p=await loadPortrait(name); if(p&&p.src) img.src=p.src;})();
}

function renderLists(){
  cntIn.textContent=pool.length; cntOut.textContent=out.length;
  listIn.innerHTML=''; listOut.innerHTML='';
  pool.forEach(n=>pill(n,listIn)); out.forEach(n=>pill(n,listOut));
}

function drawPair(){
  if(pool.length<=1) return;
  const a=Math.floor(Math.random()*pool.length);
  let b=Math.floor(Math.random()*pool.length); while(b===a) b=Math.floor(Math.random()*pool.length);
  currentPair=[pool[a],pool[b]];
  leftBtn.textContent=currentPair[0]; rightBtn.textContent=currentPair[1];
  li.removeAttribute('src'); ri.removeAttribute('src'); lg.href='#'; rg.href='#';
  (async()=>{const lp=await loadPortrait(currentPair[0]); if(lp){li.src=lp.src; lg.href=lp.creditUrl||'#';}})();
  (async()=>{const rp=await loadPortrait(currentPair[1]); if(rp){ri.src=rp.src; rg.href=rp.creditUrl||'#';}})();
  status.textContent = pool.length + ' aktiv | Ziel: ' + target;
}

function start(){
  pool=[...new Set(namesEl.value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean))];
  out=[]; history=[]; target=Math.max(1,parseInt(targetEl.value||'1',10));
  if(pool.length<2||target>=pool.length){alert('Mind. 2 unterschiedliche Namen & Ziel kleiner als Anzahl.'); return;}
  arena.style.display='block'; result.style.display='none'; renderLists(); drawPair(); undoBtn.disabled=true;
}

function pick(idx){
  if(currentPair.length<2) return;
  const w=currentPair[idx], l=currentPair[1-idx];
  pool=pool.filter(n=>n!==w&&n!==l); pool.push(w); out.push(l); history.push({w,l}); undoBtn.disabled=false;
  if(pool.length<=target){ showResult(); return; }
  renderLists(); drawPair();
}

function undo(){
  const h=history.pop(); if(!h) return;
  pool=pool.filter(n=>n!==h.w); const j=out.lastIndexOf(h.l); if(j>-1) out.splice(j,1);
  pool.push(h.w,h.l); undoBtn.disabled=history.length===0; renderLists(); drawPair();
}

function showResult(){
  arena.style.display='none'; result.style.display='block'; survivors.innerHTML='';
  pool.forEach(async n=>{const p=document.createElement('div');p.className='pill';
    const img=document.createElement('img');img.className='thumb';p.appendChild(img);
    p.appendChild(document.createTextNode(n)); survivors.appendChild(p);
    const pic=await loadPortrait(n); if(pic&&pic.src) img.src=pic.src; });
}

startBtn.onclick=start; demoBtn.onclick=()=>{namesEl.value=['Anna','Ben','Chris','Daria','Mia Malkova','Johnny Sins'].join('\n');};
leftBtn.onclick=()=>pick(0); rightBtn.onclick=()=>pick(1); undoBtn.onclick=undo; shuffleBtn.onclick=drawPair;
</script>
</body>
</html>
