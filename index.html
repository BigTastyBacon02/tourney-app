<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>1×1 Auswahl</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1f6feb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="1×1 Auswahl">
  <link rel="apple-touch-icon" href="icon-180.png">
  <style>
    body{margin:0;font-family:-apple-system,system-ui,sans-serif;background:#0b0c0f;color:#e6e7ea;padding:20px}
    h1{font-size:22px}
    textarea,input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #333;background:#111;color:#eee}
    button{padding:10px 14px;border:0;border-radius:8px;margin:4px 2px;cursor:pointer;font-weight:700}
    .pri{background:#1f6feb;color:#fff}
    .sec{background:#222;color:#eee}
    .pair{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;margin-top:14px}
    .btnName{padding:12px;border:1px solid #333;border-radius:12px;background:#181a20;color:#eee;min-height:80px;font-size:18px}
    .thumb{width:40px;height:40px;border-radius:6px;object-fit:cover;vertical-align:middle;margin-right:6px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;margin:4px;border-radius:999px;background:#222}
  </style>
</head>
<body>
<h1>1×1 Auswahl</h1>
<label>Ziel-Anzahl:<br><input id="target" type="number" value="1" min="1"></label>
<label>Namen (je Zeile):<br><textarea id="names" placeholder="Name 1\nName 2\nName 3"></textarea></label>
<button class="pri" id="startBtn">Starten</button>
<button class="sec" id="demoBtn">Demo</button>
<div id="arena" style="display:none">
  <div class="pair">
    <button id="leftBtn" class="btnName">–</button>
    <div>vs</div>
    <button id="rightBtn" class="btnName">–</button>
  </div>
  <button class="sec" id="undoBtn" disabled>Rückgängig</button>
</div>
<div id="result" style="display:none">
  <h3>Übrig:</h3>
  <div id="survivors"></div>
</div>
<script>
const $=s=>document.querySelector(s);
const namesEl=$('#names'),targetEl=$('#target'),startBtn=$('#startBtn'),demoBtn=$('#demoBtn');
const arena=$('#arena'),leftBtn=$('#leftBtn'),rightBtn=$('#rightBtn'),undoBtn=$('#undoBtn');
const result=$('#result'),survivors=$('#survivors');

let pool=[],out=[],currentPair=[],history=[],target=1;
const cacheImgs={};

async function wikiThumb(name){
  const u='https://de.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages&piprop=thumbnail&pithumbsize=96&generator=search&gsrlimit=1&gsrsearch='+encodeURIComponent(name);
  try{const r=await fetch(u);const j=await r.json();
    if(j&&j.query&&j.query.pages){
      const v=Object.values(j.query.pages)[0];
      if(v&&v.thumbnail) return {src:v.thumbnail.source,creditUrl:'https://de.wikipedia.org/wiki/'+encodeURIComponent(name)};
    }}catch(e){}
  return null;
}

async function openverseThumb(name){
  const u='https://api.openverse.engineering/v1/images/?q='+encodeURIComponent(name)+'&page_size=1&safesearch=true';
  try{const r=await fetch(u);if(!r.ok)return null;const j=await r.json();
    const it=j&&j.results&&j.results[0];if(!it)return null;
    return {src:it.thumbnail||it.url,creditUrl:it.foreign_landing_url||it.url};}
  catch(e){return null;}
}

async function loadPortrait(name){
  if(name in cacheImgs) return cacheImgs[name];
  let pic=await wikiThumb(name); if(!pic) pic=await openverseThumb(name);
  cacheImgs[name]=pic||null; return cacheImgs[name];
}

function drawPair(){
  if(pool.length<=1)return;
  const a=Math.floor(Math.random()*pool.length);
  let b=Math.floor(Math.random()*pool.length);while(b===a)b=Math.floor(Math.random()*pool.length);
  currentPair=[pool[a],pool[b]];
  leftBtn.textContent=currentPair[0]; rightBtn.textContent=currentPair[1];
  (async()=>{const lp=await loadPortrait(currentPair[0]);if(lp&&lp.src){leftBtn.innerHTML='<img class="thumb" src="'+lp.src+'">'+currentPair[0];}})();
  (async()=>{const rp=await loadPortrait(currentPair[1]);if(rp&&rp.src){rightBtn.innerHTML='<img class="thumb" src="'+rp.src+'">'+currentPair[1];}})();
}

function start(){
  pool=[...new Set(namesEl.value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean))];
  target=Math.max(1,parseInt(targetEl.value||'1',10)); out=[]; history=[];
  if(pool.length<2||target>=pool.length){alert('Mind. 2 Namen & Ziel kleiner als Anzahl.');return;}
  result.style.display='none'; arena.style.display='block'; drawPair();
}

function pick(idx){
  if(currentPair.length<2)return;
  const w=currentPair[idx],l=currentPair[1-idx];
  pool=pool.filter(n=>n!==w&&n!==l); pool.push(w); out.push(l); history.push({w,l});
  if(pool.length<=target){showResult();return;} drawPair();
}

function undo(){const h=history.pop();if(!h)return;
  pool=pool.filter(n=>n!==h.w);const j=out.lastIndexOf(h.l);if(j>=0)out.splice(j,1);
  pool.push(h.w,h.l); drawPair();
}

function showResult(){
  arena.style.display='none'; result.style.display='block'; survivors.innerHTML='';
  pool.forEach(async n=>{const span=document.createElement('div');span.className='pill';
    const img=document.createElement('img');img.className='thumb';span.appendChild(img);
    span.appendChild(document.createTextNode(n)); survivors.appendChild(span);
    const pic=await loadPortrait(n); if(pic&&pic.src) img.src=pic.src; });
}

startBtn.onclick=start; demoBtn.onclick=()=>{namesEl.value=['Anna','Ben','Chris','Daria'].join('\n');};
leftBtn.onclick=()=>pick(0); rightBtn.onclick=()=>pick(1); undoBtn.onclick=undo;
</script>
</body>
</html>